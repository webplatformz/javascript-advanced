<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>07 basics | Immutability</title>

    <link rel="icon" href="../img/zuehlke_logo.jpg">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/zuehlke.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="../lib/css/atom-one-dark.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? '../css/print/pdf.css' : '../css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section class="deck-slide">
            <h1>Immutability <br/>
                06 Basics</h1>
        </section>
        <section>
            <h2>Immutability</h2>
            <p>An immutable object is an object whose state cannot be modified after it is created.</p>
        </section>
        <section>
            <h2>Problems with mutable state</h2>
            <ul>
                <li>Tracking mutations in code is tiresome</li>
                <li>Code is hard(er) to read and error prone</li>
                <li>Code is hard(er) to test and debug</li>
                <li>Tracking changes and unwanted side-effects in objects is difficult and very expensive</li>
                <li>It's most likely not concurrency safe</li>
            </ul>
        </section>
        <section>
            <section>
                <h2>Concurrency</h2>
                <p>Basic aspects of concurrency</p>
                <ul>
                    <li>Synchronicity / Asynchronicity</li>
                    <li>Single / Multi Threading</li>
                </ul>
                <p>Javascript is executed asynchronously, <br/>but still in a single-thread</p>
            </section>
            <section>
                <h2>Synchronous + Single-Threaded</h2>
                <img src="../img/singlethreaded.png">
                <ul>
                    <li>Shared mutable state can be regarded to be <b>safe</b></li>
                    <li>Does not concern Javascript</li>
                </ul>
            </section>
            <section>
                <h2>Synchronous + Multi-Threaded</h2>
                <img src="../img/multithreaded.png">
                <ul>
                    <li>Shared mutable state is regarded to be <b>unsafe</b></li>
                    <li>Does not concern Javascript either</li>
                </ul>
            </section>
            <section>
                <h2>Asynchronous + Multi-Threaded</h2>
                <img src="../img/async-multithreaded.png">
                <ul>
                    <li>Shared mutable state is regarded to be <b>unsafe</b></li>
                    <li>Does not concern Javascript yet <br/>
                        <small>(Multi-Threading will be supported through WebAssembly)</small>
                    </li>
                </ul>
            </section>
            <section>
                <h2>Asynchronous + Single-Threaded</h2>
                <img src="../img/async-single.png">
                <ul>
                    <li>Asynchronicity is a kind of concurrency !</li>
                    <li>Recall: Mutable state. It's most likely not concurrency safe !</li>
                    <li>Shared mutable state in Javascript is <b>unsafe</b></li>
                </ul>
            </section>
            <section>
                <h2>Trivial example</h2>
                <p>Sorting a list</p>
                <pre><code class="hljs javascript" data-trim data-noescape>
let animals = [ 'hamster', 'cat', 'mouse', 'dog' ]; // shared
let sortedAnimals = animals.sort();

console.log(animals == [ 'hamster', 'cat', 'mouse', 'dog' ]); // false, why ?
console.log(animals === sortedAnimals); // true, why ?</code></pre>
            </section>
            <section>
                <h2>Not so trivial example</h2>
                <p>Event Listerns etc. triggered while modifying shared state</p>
                <pre><code class="hljs javascript" data-trim data-noescape>
let data = [ 1, 2, 3, 4 ];
let sum = 0; // shared
for (let index = 0; index < data.length; index++) {
  sum += data[index];
}

console.log(sum === 10); // true, but always true ?</code></pre>
            </section>
        </section>
        <section>
            <section>
                <h2>Immutability in Javascript</h2>
                <ul>
                    <li>Primitives are immutable by default</li>
                    <li>There is no modifier to "lock" objects</li>
                    <li>Immutability is done by (shallow) copying objects</li>
                </ul>
            </section>
            <section>
                <h2>Don't do that (any more)</h2>
                <ul>
                    <li><strike>jQuery or any other library</strike> = probably not necessary</li>
                    <li><strike>for-loop & hasOwnProperty()</strike> = error prone</li>
                    <li><strike>array.slice()</strike> = wrong intention</li>
                </ul>
            </section>
            <section>
                <h2>Objects - Object.assign()</h2>
                <pre><code class="hljs javascript" data-trim data-noescape>
let animal = {
    name: "Homer",
    age: 2,
    type: "hamster",
    legs: 4
};

let shallowCopy = Object.assign({}, animal);
console.log(animal === shallowCopy); // false</code></pre>
            </section>
            <section>
                <h2>Arrays - [].concat()</h2>
                <pre><code class="hljs javascript" data-trim data-noescape>
let animals = [ 'hamster', 'cat', 'mouse', 'dog' ];

let shallowCopy = [].concat(animals);
console.log(animals === shallowCopy); // false</code></pre>
            </section>
            <section>
                <h2>Objects - Destructors</h2>
                <pre><code class="hljs javascript" data-trim data-noescape>
let animal = {
    name: "Homer",
    age: 2,
    type: "hamster",
    legs: 4
};

let shallowCopy = { ...animal };
console.log(animal === shallowCopy); // false</code></pre>
            </section>
            <section>
                <h2>Arrays - Destructors</h2>
                <pre><code>let animals = [ 'hamster', 'cat', 'mouse', 'dog' ];

let shallowCopy = [ ...animals ];
console.log(animals === shallowCopy); // false</code></pre>
            </section>
            <section>
                <h2>Be aware though</h2>
                <ul>
                    <li>Object.assign(), [].concat(), Destructors are flat shallow copies</li>
                    <li>Not suitable for more complex (deep) entities</li>
                </ul>
                <p><a href="" target="_blank">Exercises (TODO)</a></p>
            </section>
            <section>
                <h2>Wrap-Up: Immutability</h2>
                <ul>
                    <li>Very little code to write</li>
                    <li>Very simple to use</li>
                </ul>
            </section>
        </section>
        <section>
            <section>
                <h2>Disadvantage</h2>
                <ul>
                    <li>Very tiny performance overhead (object creation)</li>
                    <li>Requires a lot of discipline (mutating state is so easy)</li>
                </ul>
            </section>
            <section>
                <h2>Advantage</h2>
                <ul>
                    <li>Concurrency safe (multi-threading, asynchronicity, ...)</li>
                    <li>No expensive synchronization between threads</li>
                    <li>No expensive state tracking <strike>Object.observe(obj, fn)</strike></li>
                    <li>Better code quality</li>
                </ul>
            </section>
            <section>
                <h2>Conclusion</h2>
                <ul>
                    <li>Different, more functional-style application design</li>
                    <li>You can assume everything immutable</li>
                    <li>It's a very simple pattern !</li>
                </ul>
            </section>
        </section>
        <section>
            <h2>Immutability</h2>
            <ul>
                <li>Immutability.js</li>
                <li>Redux</li>
            </ul>
        </section>
        <section>
            <h2>Further Readings &amp; Resources</h2>
            <ul>
                <li>
                    <a href="http://web.mit.edu/6.005/www/fa15/classes/09-immutability/#reading_9_mutability_immutability"
                       target="_blank">Mutability &amp; Immutability</a></li>
                <li>
                    <a href="https://www.miles.no/blogg/tema/teknisk/why-care-about-functional-programming-part-1-immutability"
                       target="_blank">Why care about functional programming? Immutability</a></li>
                <li>
                    <a href="https://medium.com/@yej.arin.choi/this-is-a-post-that-summarizes-my-dive-into-immutability-in-programming-what-it-is-why-its-34cbba44f889"
                       target="_blank">Immutability in Javascript</a></li>
                <li><a href="http://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/"
                       target="_blank">Immutability with ReactJs</a></li>
            </ul>
        </section>
        <section class="deck-slide">
            <h1>Questions?</h1>
        </section>
    </div>
</div>

<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            { src: '../plugin/markdown/marked.js' },
            { src: '../plugin/markdown/markdown.js' },
            { src: '../plugin/notes/notes.js', async: true },
            {
                src: '../plugin/highlight/highlight.js', async: true, callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>
</body>
</html>
